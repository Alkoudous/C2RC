{% extends 'base.html' %}

{% block content %}

    <!-- TITLE -->
    <div class="row text-end" style="padding-top:1rem;">

        <div class="col-auto ">
            <h1 style="text-align: center; color: #C4A484; padding-bottom:1rem;
                font-family:Audiowide, Fantasy; font-weight:bold;">
                <a class="navbar-brand" href="{{ url_for('index')}}" style=";"> C2RC </a>
            </h1>
        </div>

        <div class=" input-group col-auto text-end justify-content-end align-bottom"
             style="width:72%; padding-top:0.5rem; text-align:right;">

                <h3 style="color: #C4A484; padding-bottom:1rem;
                    font-family:Audiowide, Fantasy; font-weight: bold;">
                        SELECTED DATABASE &nbsp;
                </h3>

        </div>

        <div class=" input-group col-auto text-end justify-content-end align-bottom"
             style="width:15.2%; padding-top:0.3rem; text-align:right;">

                <h3 style="color: #C4A484; padding-bottom:1rem; font-family:Audiowide, Fantasy; font-weight: bold;">
                        <span class="badge rounded-pill text-bg-info" style="padding-left:2rem; padding-right:2rem;
                        padding-bottom:0.5rem; padding-top:0.5rem; font-family:Helvetica, 'Brush Script', Fantasy">
                            {%if response['db']|length > 0 %} {{ response['selected_db_name'] }} {%else%} None {%endif%}
                        </span>
                </h3>


        </div>

    </div>
    <p></p>


    <!-- ANYLISYS RESULTS -->
    <div class="card">

        <div class="card-body border-primary" style="padding-bottom:1.5rem">


            <!-- SUBMIT A RECONSTITUTION ID -->
            <div class="row" style="padding-top:0REM;">

                <div class="column" >

                    <form class="row g-3"  action="analysis" method="POST">

                        <!-- HEADER -->
                        <div class="col-auto" style="width:62.6%; padding-top: 0rem" >
                          <h3><a class="nav-link " ></a>Reconstituted</h3>
                        </div>

                        <!-- INPUT BOX -->
                        <div class="col-auto" style="padding-top: 0rem">
                          <input type="search" class="form-control me-2" placeholder="Reconstitution-ID"
                                 aria-label="Reconstitution-ID" aria-describedby="basic-addon1"
                                 style="text-align:center; width:10.5rem; padding-right:0rem"
                                 value="{{ submitted_reconstitution_id }}" name="reconstitution_id"
                                 id="Reconstitution_id">
                        </div>

                        <!-- SUBMIT BUTTON-->
                        <div class="col-auto" style="padding-top: 0rem ">
                        <button class="btn btn-primary border-light btn-light align-top" type="submit" style="background-color:white;">
                            <h5>
                                <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                     style="padding-right:1.5rem; padding-left:1.5rem; padding-top:0.5rem; padding-BOTTOM:0.5rem;">
                                   Submit a reconstitution ID
                                </span>
                            </h5>
                        </button>
                        </div>

                    </form>

                </div>

            </div>


            <!-- 4. EXTENDED FAMILY DYNAMIC TABLE + REGROUPING-->
            <div class="card bg-light mb-3; position-relative;"  style="width: 100%; height=500%;">

                <!-- ACCORDION -->
                <div class="accordion accordion-flush" id="accordionFlush2" style="tex-align:right">

                    <!-- ACCORDION ITEM 1 : Analysis -->
                    <div class="accordion-item">

                        <!-- ACCORDION HEADER -->
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                  data-bs-target="#flush-collapse1" aria-expanded="false"
                                  aria-controls="flush-collapse1">
                                <h4>

                                    <div class="row">
                                        <div class="col" style="padding-top:0.2rem;"> Analysis </div>
                                        {% if analysis_data['cid'] %}
                                        <div class="col">
                                            <span class="badge align-top align-text-top rounded-pill result"
                                                  style="padding-bottom:0.4rem; padding-top:0.4rem;
                                                  padding-left:1.5rem; padding-right:1.5rem;">

                                                {{ analysis_data['cid'] }} &nbsp; is &nbsp;

                                                {% if analysis_data['flag'] == "Unlikely" %}
                                                    <span class="badge align-top align-text-top  rounded-pill unlikely"
                                                          style="padding-bottom:0.3rem; padding-top:0.3rem;
                                                          padding-left:1rem; padding-right:1rem;">
                                                        {{analysis_data['flag']}}
                                                    </span>

                                                {% elif analysis_data['flag'] == "Likely" %}
                                                    <span class="badge align-top align-text-top rounded-pill likely"
                                                          style="padding-bottom:0.3rem; padding-top:0.3rem;
                                                          padding-left:1rem; padding-right:1rem;">
                                                        {{analysis_data['flag']}}
                                                    </span>

                                                {% elif analysis_data['flag'] == "Uncertain" %}
                                                    <span class="badge align-top align-text-top rounded-pill uncertain"
                                                          style="padding-bottom:0.3rem; padding-top:0.3rem;
                                                          padding-left:1rem; padding-right:1rem;">
                                                        {{analysis_data['flag']}}
                                                    </span>
                                                {% endif %}
                                            </span>
                                        </div>
                                        {% endif %}
                                    </div>

                                </h4>
                            </button>
                        </h2>

                        <!-- ACCORDION BODY -->
                        <div id="flush-collapse1" class="accordion-collapse collapse show"
                             data-bs-parent="#accordionFlush2">

                            <div class="accordion-body">

                                <!-- 4. DYNAMIC RECONSTITUTED NAME AND RULES' SUMMARY -->
                                {% if analysis_data['flag'] is not none %}
                                    <div class="row"
                                         style="width: 102%; text-align:justify; scrolling: auto; overflow:auto;">

                                        <!--  SUMMARY TEXT -->
                                        <div class="col-sm-6 mb-3 mb-sm-0" style="width:43%">

                                            <div class="card border-primary h-100">

                                                <div class="card-body text-wrap"
                                                     style="height:15rem; valign:middle; overflow:auto;" >

                                                    <!-- PERSON'S NAME -->
                                                    <h5 class="card-title" style="font:Brush Script MT">
                                                        Natural Language Summary
                                                    </h5>

                                                    <!-- RECONSTITUTED ID -->
                                                    <p class="card-text text-wrap text-break" style="overflow:auto">
                                                        <h5 style="padding-left:1rem; color:brown; align:bottom">{{ analysis_data['name'] }}</h5>
                                                        <p style="padding-left:2rem">{{ analysis_data['marital_text'] }}</p>
                                                    </p>

                                                </div>

                                                <div class="card-footer text-body-secondary"
                                                     style="text-align:center; padding-bottom:0rem">
                                                    <h5>
                                                    <span class="badge rounded-pill result"
                                                          style="padding-bottom:0.5rem;  padding-top:0.5rem;">
                                                        {{ origin }}
                                                    </span>
                                                    </h5>

                                                </div>

                                            </div>
                                        </div>

                                        <!--  RULES' SUMMARY -->
                                        <div class="col-sm-6" style="width:57%">

                                            <div class="card border-primary h-100">

                                            <!-- BODY -->
                                            <div class="card-body" style="font-size: 12px">
                                                <h5 class="card-title">Rules' Summary</h5>
                                                <p class="card-text"><pre>{{ analysis_data['html_summary'] }}</pre>
                                                </p>
                                            </div>

                                            <!-- FOOTER -->
                                            <div class="card-footer text-body-secondary"
                                                 style="text-align:center;padding-bottom:0rem">
                                                <strong>
                                                <h5>
                                                    {% if analysis_data['bads']>0 %}
                                                        <span class="badge rounded-pill unlikely"
                                                              style="padding-bottom:0.5rem;  padding-top:0.5rem;">
                                                           {{ analysis_data['bads'] }} broken hard rule{% if analysis_data['bads']>1 %}s{% else %}{% endif %}
                                                        </span>
                                                    {% endif %}

                                                    {% if analysis_data['bads']==0 and analysis_data['maybes']==0 %}
                                                        <span class="badge rounded-pill likely"
                                                            style="padding-bottom:0.5rem;  padding-top:0.5rem;">
                                                          No broken rule.
                                                        </span>
                                                    {% endif %}

                                                    {% if analysis_data['maybes']>0 %}
                                                        <span class="badge rounded-pill uncertain"
                                                            style="padding-bottom:0.5rem;  padding-top:0.5rem;">
                                                           {{ analysis_data['maybes'] }} broken soft rule{% if analysis_data['maybes']>1 %}s{% else %}{% endif %}
                                                        </span>

                                                    {% endif %}
                                                </h5>
                                                </strong>
                                            </div>

                                        </div>
                                        </div>

                                    </div>
                                {% endif %}

                            </div>
                        </div>

                    </div>


                    <!-- ACCORDION ITEM 2 : PERSON OBSERVATION TABLE -->
                    <div class="accordion-item">

                        <!-- ACCORDION HEADER -->
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed " type="button" data-bs-toggle="collapse"
                                  data-bs-target="#flush-collapse2" aria-expanded="false" aria-controls="flush-collapse2">

                                <div class="row">

                                        <div class="col-auto"> <H4>Person Observations</H4> </div>

                                        {% if analysis_data['cid'] %}
                                        <div class="col-auto" style="padding-top:0.1rem;">
                                            <span class="badge align-top align-text-top rounded-pill result"
                                                  style="padding-bottom:0.4rem; padding-top:0.4rem;
                                                  padding-left:1.5rem; padding-right:1.5rem;">

                                                {{ analysis_data['cid'] }} &nbsp; is &nbsp;

                                                {% if analysis_data['flag'] == "Unlikely" %}
                                                    <span class="badge align-top align-text-top  rounded-pill unlikely"
                                                          style="padding-left:1rem; padding-right:1rem;">
                                                        {{analysis_data['flag']}}
                                                    </span>

                                                {% elif analysis_data['flag'] == "Likely" %}
                                                    <span class="badge align-top align-text-top rounded-pill likely"
                                                          style="padding-left:1rem; padding-right:1rem;">
                                                        {{analysis_data['flag']}}
                                                    </span>

                                                {% elif analysis_data['flag'] == "Uncertain" %}
                                                    <span class="badge align-top align-text-top rounded-pill uncertain"
                                                          style="padding-left:1rem; padding-right:1rem;">
                                                        {{analysis_data['flag']}}
                                                    </span>
                                                {% endif %}
                                            </span>
                                        </div>
                                        {% endif %}
                                    </div>

                            </button>
                        </h2>

                        <!-- ACCORDION BODY -->
                        <div id="flush-collapse2" class="accordion-collapse collapse show"
                             data-bs-parent="#accordionFlush2">
                            <div class="accordion-body">

                            <!-- DESCRIPTION OF THE RULE: children with more than one paren -->
                            <div class="card-body">

                                {% if analysis_data['grounded_table']|length != 0
                                or analysis_data['groundless_table']|length !=0 %}

                                <!-- DESCRIPTION OF GROUNDED, GROUNDLESS AND BROKEN RULES -->
                                <div class="accordion accordion-flush" id="accordionFlushExample">

                                    <!-- ACCORDION ITEM 1 -->
                                    <div class="accordion-item">

                                        <!-- ACCORDION ITEM 1 : HEADER -->
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                                                <strong>Grounded - Groundless description</strong>
                                            </button>
                                        </h2>

                                        <!-- ACCORDION ITEM 1 : CONTENT -->
                                        <div id="flush-collapseOne" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                            <div class="accordion-body">

                                                <!-- DESCRIPTION OF GROUNDED AND GROUNDLESS  -->
                                                <div class="alert align-items-center alert-warning alert-dismissible fade show"
                                                     role="alert" style="padding-bottom:0rem">

                                                    <!-- DESCRIPTION OF GROUNDED -->
                                                    <p class="card-text" style="text-align: justify;">
                                                        <strong style="color:brown;">GROUNDED</strong> or evidence-based
                                                        subgroups highlight that the reconstituted individual participated
                                                        in several events with the same relative.
                                                        <br>
                                                        <strong style="color:brown;">GROUNDLESS</strong> subgroups of a
                                                        reconstitution (in red) highlight that the reconstituted individual
                                                        participated in only one event with the same relative.
                                                    </p>

                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close">

                                                    </button>

                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!-- ACCORDION ITEM 2 -->
                                    {% if analysis_data['description'] is not none and analysis_data['description']|length > 0  %}
                                    <div class="accordion-item">

                                        <!-- ACCORDION ITEM 1 : HEADER -->
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
                                                <strong>
                                                    How to look for and solve highlighted issues
                                                    of reconstituted
                                                        {% if analysis_data['cid'] %}
                                                            {{ analysis_data['cid'] }}
                                                        {% else %}
                                                            ---
                                                        {% endif %}
                                                </strong>
                                            </button>
                                        </h2>

                                        <div id="flush-collapseTwo" class="accordion-collapse collapse" data-bs-parent="#accordionFlushExample">
                                            <div class="accordion-body">
                                                <!-- DESCRIPTION OF BROKEN RULES -->
                                                <div class="alert align-items-center alert-warning alert-dismissible fade show"
                                                     role="alert" style="padding-bottom:0rem">

                                                    <!-- DESCRIPTION OF GROUNDED -->
                                                    {% for key, description in analysis_data['description'].items()  %}
                                                        <div><strong style="color:brown">{{ key }}</strong></div>
                                                        <div style="padding-left:1rem">
                                                            <strong style="color:black"> Confirm the issue - </strong>
                                                            {{ description[0] }} </div>
                                                        <div style="padding-left:1rem">
                                                            <strong style="color:black"> Resolve the issue - </strong>
                                                            {{ description[1] }} </div>
                                                        <br>
                                                    {% endfor %}
                                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    {% endif  %}

                                </div>

                                <!-- PERSON OBSERVATIONS TABLE FORM-->
                                <form class="row g-3"  action="write_manual_consistency_validation" method="POST" style="text-align:center">

                                    <div class="card-body" style="padding-left:0rem; padding-right:0rem;">

                                        <!-- TABLE CARD BODY height:20rem; -->
                                        <div class="card-body align-middle align-text-center table-responsive"
                                             style="text-align: center; overflow-x:auto; overflow:auto;
                                             padding-top:0rem; padding-bottom: 0rem;">

                                            <!-- TITLE-->
                                            <h5 class="card-title"></h5>

                                            <!-- TABLE OF RECONSTITUTED OF A SPECIFIC SIZE -->
                                            <table class="table table-sm caption-top table-hover align-middle"
                                                   id="observations" style="font-size:12px; text-align:center; position:fixed-top">

                                                <!-- TABLE HEADER -->
                                                <thead class="table-success align-text-center align-middle"
                                                       style="font-size:16px; position:-webkit-sticky; position:sticky;
                                                       top:0; z-index:2;">
                                                    <tr style="height:3rem;">
                                                        <th scope="col"> </th>
                                                        <th scope="col">E. Type</th>
                                                        <th scope="col">Cert.</th>
                                                        <th scope="col">Cert. Date</th>
                                                        <th scope="col">Rec. ID</th>
                                                        <th scope="col">Ext. Fa. ID</th>
                                                        <th scope="col">Rec. Name</th>
                                                        <th scope="col">Role</th>
                                                        <th scope="col">Ext. Fa. Name</th>
                                                        <th scope="col">Ext. Fa. Cluster</th>
                                                        <th scope="col">Row</th>
                                                        <th scope="col">Subgroup</th>
                                                    </tr>
                                                </thead>


                                                <!-- TABLE BODY -->
                                                <tbody class="table-group-divider">

                                                    <!-- EMPTY ROW -->
                                                    <tr class="align-middle table-white">
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                    </tr>

                                                    <!-- GROUNDED TABLE ROWS -->
                                                    {% for key, list in analysis_data['grounded_table'].items() %}
                                                        {% set outer_loop = loop %}
                                                        {% for dict in list %}
                                                            <tr class="align-middle table-warning"
                                                            style="height:0rem; padding-bottom:0rem; padding-top:0rem;"
                                                            onmouseout="ChangeColor(this, false);" onclick="ChangeColor(this, true);">

                                                                <th scope="row">{{ outer_loop.index }}.{{loop.index}}</th>
                                                                <td style="color:brown">
                                                                    {%  if dict['role'] in ['--bHasMother->', '<-bHasMother--', '<-bHasFather--', '--bHasFather->', '--gHasMother->', '<-gHasMother--', '<-gHasFather--', '--gHasFather->', '<--married----', '---married--->'] %}
                                                                        M
                                                                    {%  elif dict['role'] in ['<-hasFather---', '<-hasMother---', '--nHasFather->', '<-nHasMother---', '--nHasMother->'] %}
                                                                        B
                                                                    {%  endif %}
                                                                </td>
                                                                <td style="color:brown">{{ dict['certificate'] }}</td>
                                                                <td style="color:brown">{{ dict['certificateDate'] }}</td>
                                                                <td style="color:brown">{{ dict['p_ID'] }}</td>
                                                                <td style="color:brown">{{ dict['associationPersonID'] }}</td>
                                                                <td style="color:brown">{{ dict['p_name'] }}</td>
                                                                <td style="color:brown">{{ dict['role'] }}</td>
                                                                <td style="color:brown">{{ dict['associationPersonName'] }}</td>
                                                                <td style="color:brown">{{ dict['associated_cluster'] }}</td>
                                                                <td style="color:brown">
                                                                    <input type="search" class="form-control me-2" placeholder="Cluster-ID"
                                                                         aria-label="Cluster-ID" aria-describedby="basic-addon1"
                                                                         value="{{ dict['rid'] }}" name="row-id" id="row-id" hidden="">
                                                                    {{ dict['rid'] }}
                                                                </td>
                                                                <td class="align-items-center align-self-center align-content-center d-print-flex align-middle align-text-middle"
                                                                    style="color:red;
                                                                    padding-bottom:0rem; padding-top:1rem; padding-left:0rem;
                                                                    padding-right:0rem; display:flex; flex-wrap:rap; align-items:flex-start;
                                                                    justify-content:flex-start; justify-content:center; align-items:center;
                                                                    height:2rem;">

                                                                    <input type="search" value="{{ loop.index }}" name="idx1" id="idx1" hidden="">

                                                                    <select onchange="color(this, '{{dict['rid']}}', {{ nightfall }})"
                                                                            class="form-select form-select_sm mb-3
                                                                            align-middle align-text-middle form-select-primary"
                                                                            name="g_selected" id="g_selected" style="padding-bottom:0rem;
                                                                            padding-top:0rem; width:5rem; height:1.4rem; text-align:center;
                                                                            font-size:13px; align-text:middle;">

                                                                        <option selected>ID</option>
                                                                        {% for i in range(1, analysis_data['grounded_table']|length + 50 ) %}
                                                                            {% if key == i-1%}
                                                                                <option selected value="{{ i }}">{{ i }}</option>
                                                                            {% else %}
                                                                                <option value="{{ i }}">{{ i }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}

                                                                    </select>

                                                                </td>

                                                            </tr>
                                                        {% endfor %}
                                                        <!-- EMPTY GROUNDED ROW -->
                                                        <tr class="align-middle table-white"
                                                            style="height:0rem; padding-bottom:0rem; padding-top:5rem; color:red;"
                                                            onmouseout="ChangeColor(this, false);" onclick="ChangeColor(this, true);">
                                                            <th scope="row"></th>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                        </tr>
                                                    {% endfor %}

                                                    <!-- GROUNDLESS TABLE ROWS -->
                                                    <!-- display: flex; flex-wrap:rap; align-items:flex-start; justify-content:flex-start; -->
                                                    {% set map = ({"9999":999}) %}
                                                    {% for key, list in analysis_data['groundless_table'].items() %}
                                                        {% for dict in list %}

                                                            <tr class="align-middle table-secondary table-danger"
                                                            style="height:0rem; padding-bottom:0rem; padding-top:0rem;"
                                                            onmouseout="ChangeColor(this, false);" onclick="ChangeColor(this, true);">

                                                                <th scope="row">{{loop.index}}</th>
                                                                <td style="color:brown">
                                                                    {%  if dict['role'] in ['--bHasMother->', '<-bHasMother--', '<-bHasFather--', '--bHasFather->', '--gHasMother->', '<-gHasMother--', '<-gHasFather--', '--gHasFather->', '<--married----', '---married--->'] %}
                                                                        M
                                                                    {%  elif dict['role'] in ['<-hasFather---', '<-hasMother---', '--nHasFather->', '<-nHasMother---', '--nHasMother->'] %}
                                                                        B
                                                                    {%  endif %}
                                                                </td>
                                                                <td style="color:brown">{{ dict['certificate'] }}</td>
                                                                <td style="color:brown">{{ dict['certificateDate'] }}</td>
                                                                <td style="color:brown">{{ dict['p_ID'] }}</td>
                                                                <td style="color:brown">{{ dict['associationPersonID'] }}</td>
                                                                <td style="color:brown">{{ dict['p_name'] }}</td>
                                                                <td style="color:brown">{{ dict['role'] }}</td>
                                                                <td style="color:brown">{{ dict['associationPersonName'] }}</td>
                                                                <td style="color:brown">{{ dict['associated_cluster'] }}</td>
                                                                <td style="color:brown">
                                                                    <input type="search" value="{{ dict['rid'] }}" name="row-id-2" id="row-id-2" hidden="">
                                                                    {{ dict['rid'] }}
                                                                </td>
                                                                <td class="align-items-center align-self-center align-content-center d-print-flex align-middle align-text-middle"
                                                                    style="padding-bottom:0rem; padding-top:0rem;
                                                                    padding-left:0rem; padding-right:0rem;  justify-content: center;
                                                                    align-items: center; height:2rem;">

                                                                    <input type="search" value="{{loop.index}}" name="idx2" id="idx2" hidden="hidden">

                                                                    <select onchange="color(this, '{{dict['rid']}}', {{ nightfall }})"
                                                                            class="form-select form-select_sm align-top"
                                                                            name="g-less-selected" id="g-less-selected"
                                                                            style="padding-bottom:0rem; padding-top:0rem;
                                                                            width:5rem; font-size:13px; height:1.4rem; text-align:center;">
                                                                        <option value="0">Group-ID</option>
                                                                        {% set w = loop.index %}
                                                                        {% set y = analysis_data['grounded_table']|length %}
                                                                        {% for i in range(1, analysis_data['grounded_table']|length + 50) %}
                                                                            {% if i == w + y %}
                                                                                {% if map[dict['rid']] %}
                                                                                    <option selected value="{{ map[dict['rid']] }}">
                                                                                        {{ map[dict['rid']] }}
                                                                                    </option>
                                                                                {% else %}
                                                                                    {% set x = map.__setitem__(dict['rid'], w + y) %}
                                                                                    <option selected value="{{ map[dict['rid']] }}">
                                                                                        {{ map[dict['rid']] }}
                                                                                    </option>
                                                                                {% endif %}
                                                                            {% else %}
                                                                                <option value="{{ i }}">{{ i }}</option>
                                                                            {% endif %}
                                                                        {% endfor %}
                                                                    </select>

                                                                </td>
                                                            </tr>

                                                            <!-- EMPTY GROUNDED ROW -->
                                                            <tr class="align-middle table-white"
                                                            style="height:0rem; padding-bottom:0rem; padding-top:5rem; color:red;"
                                                            onmouseout="ChangeColor(this, false);" onclick="ChangeColor(this, true);">
                                                            <th scope="row"></th>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                            <td></td>
                                                        </tr>
                                                        {% endfor %}
                                                    {% endfor %}

                                                </tbody>

                                            </table>

                                        </div>

                                        <!-- SUBMIT BUTTON FOR WRITE AND VIEW RDF -->
                                        {% if selected_size <= 0 or
                                        (analysis_data['grounded_table']|length == 0
                                        and analysis_data['groundless_table']|length ==0) %}
                                        <div class="row">

                                            <div class="col">
                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                        style=" height:1rem; text-align: center; padding-top:0rem;
                                                        padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                        width:100%;" name="rdf" value="write" disabled>
                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                         style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                       Submit Validation
                                                    </span>
                                                </button>
                                            </div>

                                            <div class="col">
                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                        style=" height:1rem; text-align: center; padding-top:0rem;
                                                        padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                        width:100%;" name="rdf" value="merger-and-write" disabled>
                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                         style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                       Merge & Validate
                                                    </span>
                                                </button>
                                            </div>

                                            <div class="col">
                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                        style=" height:1rem; text-align: center; padding-top:0rem;
                                                        padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                        width:100%;" name="rdf" value="view" disabled>
                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                         style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                       View the validated RDF
                                                    </span>
                                                </button>
                                            </div>

                                        </div>
                                        {% else %}
                                        <div class="row">

                                            <div class="col">
                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                        style=" height:1rem; text-align: center; padding-top:0rem;
                                                        padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                        width:100%;" name="rdf" value="write">
                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                         style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                       Submit Validation
                                                    </span>
                                                </button>
                                            </div>

                                            <div class="col">
                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                        style=" height:1rem; text-align: center; padding-top:0rem;
                                                        padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                        width:100%;" name="rdf" value="merger-and-write">
                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                         style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                       Merge & Validate
                                                    </span>
                                                </button>
                                            </div>


                                            <div class="col">
                                                {% if family[(family.keys()|list)[0]][4] == 'yes' %}
                                                    <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                            style=" height:1rem; text-align: center; padding-top:0rem;
                                                            padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                            width:100%;" name="rdf" value="view">
                                                        <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                             style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                           View the validated RDF
                                                        </span>
                                                    </button>
                                                {% else %}
                                                    <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                            style=" height:1rem; text-align: center; padding-top:0rem;
                                                            padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                            width:100%;" name="rdf" value="view" disabled>
                                                        <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                             style="padding-bottom:0.5rem; padding-top:0.5rem; width:100%;">
                                                           View the validated RDF
                                                        </span>
                                                    </button>
                                                {% endif %}
                                            </div>

                                        </div>
                                        {% endif %}

                                        <input type="text" value="{{ selected_size }}" name="occurrence_recon_size"
                                               id="occurrence_recon_size" hidden="hidden">

                                        <!-- TABLE LIMIT  -->
                                        <input type="text" value="{{max_rows}}" name="occurrence_recon_table_limit"
                                               id="occurrence_recon_table_limit" hidden="hidden">

                                        <input type="text" value="{{ selected_index }}" name="occurrence_index"
                                               id="occurrence_index" hidden="hidden">

                                        <input type="search" value="{{ flag_filter }}" name="nxt_tbl_idx_filter"
                                               id="nxt_tbl_idx_filter" hidden="hidden">

                                        <!-- VALIDATED RECONSTITUTIONS  -->
                                        <input type="search" value="{{ validated }}" name="write_validated_rdf"
                                             id="write_validated_rdf" hidden="hidden">

                                        <!-- RECONSTITUTION ID -->
                                        <input type="search" value="{{ analysis_data['cid'] }}" name="reconstitution-id"
                                             id="reconstitution-id" hidden>

                                        <!-- NEXT PAGE  -->
                                        <input type="text" name="write_validated_next_page" id="write_validated_next_page"
                                               value="{{ next_page }}" aria-describedby="inputGroup-sizing-sm" hidden>

                                    </div>

                                </form>

                                {% endif %}

                            </div>

                        </div>
                    </div>

                    </div>


                    <!-- ACCORDION ITEM 4: FAMILY THREAD -->
                    <div class="accordion-item">

                        <!-- Family : ACCORDION HEADER -->
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed " type="button" data-bs-toggle="collapse"
                                  data-bs-target="#flush-collapse4" aria-expanded="false" aria-controls="flush-collapse4">

                                <div class="row">

                                    <div class="col-auto"> <H4>Family Thread</H4> </div>

                                    {% if analysis_data['cid'] %}
                                    <div class="col-auto" style="padding-top:0.1rem;">
                                        <span class="badge align-top align-text-top rounded-pill result"
                                              style="padding-bottom:0.4rem; padding-top:0.4rem;
                                              padding-left:1.5rem; padding-right:1.5rem;">

                                            {{ analysis_data['cid'] }} &nbsp; is &nbsp;

                                            {% if analysis_data['flag'] == "Unlikely" %}
                                                <span class="badge align-top align-text-top  rounded-pill unlikely"
                                                      style="padding-left:1rem; padding-right:1rem;">
                                                    {{analysis_data['flag']}}
                                                </span>

                                            {% elif analysis_data['flag'] == "Likely" %}
                                                <span class="badge align-top align-text-top rounded-pill likely"
                                                      style="padding-left:1rem; padding-right:1rem;">
                                                    {{analysis_data['flag']}}
                                                </span>

                                            {% elif analysis_data['flag'] == "Uncertain" %}
                                                <span class="badge align-top align-text-top rounded-pill uncertain"
                                                      style="padding-left:1rem; padding-right:1rem;">
                                                    {{analysis_data['flag']}}
                                                </span>
                                            {% endif %}
                                        </span>
                                    </div>
                                    {% endif %}

                                </div>

                            </button>
                        </h2>


                        <!-- VALIDATION CONSISTENCY HELPER ACCORDION BODY -->
                        <div id="flush-collapse4" class="accordion-collapse collapse show"
                             data-bs-parent="#accordionFlush2">

                            <div class="accordion-body">

                                <!-- DESCRIPTION OF THE RULE: children with more than one paren -->
                                <div class="card-body">

                                    <!-- FAMILY DIV -->
                                    {% if (family.keys()|list)[0] is not none %}
                                    <form class="row g-3"  action="validation_consistency" method="POST">
                                        <div style="padding-left:1rem">

                                        {% set keys = family.keys() | list -%}
                                        {% set first = keys[0] -%}
                                        {% set size = family|length -%}

                                        <!-- RECONSTITUTED NAME VARIANTS COUNT -->

                                        {% if family[first][2] > 1 %}

                                            <span aria-hidden="true" class="badge rounded-pill unlikely"
                                                  style="padding-bottom:0.5rem; padding-top:0.5rem; width:10.5rem;
                                                  padding-left:1.5rem; padding-right:1.5rem; ">
                                                 <strong>{{ family[first][2] }} name variants  &nbsp;</strong>

                                                    <span aria-hidden="true" class="badge rounded-pill uncertain"
                                                    style="padding-bottom:0.5rem; padding-top:0.5rem;">
                                                        {% if family[first][4] == 'yes' %}
                                                         <strong style="font-size:12px">VALIDATED</strong>
                                                        {% else %}
                                                        <strong style="font-size:12px">NOT VALIDATED</strong>
                                                        {% endif %}
                                                    </span>

                                            </span>
                                            <br>

                                        <!-- RECONSTITUTED WITH MORE THAN ONE NAME VARIANTS-->
                                        {% else %}

                                            <span aria-hidden="true" class="badge rounded-pill likely"
                                                  style="padding-bottom:0.5rem; padding-top:0.5rem; width:10.5rem;
                                                  padding-left:1.5rem; padding-right:1.5rem;">
                                                 <strong>{{ family[first][2] }} name variants  &nbsp;</strong>

                                                <span aria-hidden="true" class="badge rounded-pill uncertain"
                                                    style="padding-bottom:0.5rem; padding-top:0.5rem;">
                                                        {% if family[first][4] == 'yes' %}
                                                         <strong style="font-size:12px">VALIDATED</strong>
                                                        {% else %}
                                                        <strong style="font-size:12px">NOT VALIDATED</strong>
                                                        {% endif %}
                                                </span>

                                            </span>
                                            <br>

                                        {% endif %}


                                        <!-- RECONSTITUTED NAME VARIANTS -->
                                        {% if family[first][1] %}
                                            <div style="padding-left:3rem">
                                                <strong style="color:brown; font-size:24px;">
                                                    {{ family[first][1] }}
                                                </strong>
                                                <br>
                                                ║
                                            </div>
                                        {% endif %}


                                        {% for i in range(1, size) %}

                                            <!-- ROLES -->
                                            <div class="row" style="padding-left:3rem">
                                                <div class="col-auto" >
                                                    {% if i == size - 1 %}
                                                        ╚══ <b style="color:brown; width:7rem"> {{loop.index}} - {{ family[keys[i]][0] }}</b>
                                                    {% else %}
                                                        ╠══ <b style="color:brown; width:7rem"> {{loop.index}} - {{ family[keys[i]][0] }}</b>
                                                    {% endif %}
                                                    {% if family[keys[i]][2] > 1 %}
                                                    <span aria-hidden="true" class="badge rounded-pill unlikely"
                                                              style="padding-bottom:0.2rem; padding-top:0.2rem; width:8rem;">
                                                         {{ family[keys[i]][2] }} name variants
                                                    </span>
                                                    {% endif %}
                                                </div>
                                            </div>


                                            {% if family[keys[i]][3] > 1 %}

                                                <!-- EMPTY ROW -->
                                                <div class="row" style="padding-left:3rem">
                                                    <div class="col-auto" style="width:6%;">
                                                        {% if i == size - 1 %}
                                                        {% else %}
                                                        ║
                                                        {% endif %}
                                                    </div>
                                                    <div class="col-auto align-top" style="overflow-x: auto; scroll; width:90%;">
                                                        ║
                                                    </div>
                                                </div>


                                                <!-- CLUSTER SIZE ROW -->
                                                <div class="row" style="padding-left:3rem">

                                                    <!-- NAME VARIANTS EMPTY ROW -->
                                                    <div class="col-auto" style="width:6%;">
                                                        {% if i == size - 1 %}
                                                        {% else %}
                                                        ║
                                                        {% endif %}
                                                    </div>

                                                    <!-- NAME VARIANTS  -->
                                                    <div class="col-auto align-top" style="overflow-x: auto; scroll; width:90%;">
                                                        ╠══ Reconstitution of size {{ family[keys[i]][3] }}
                                                    </div>

                                                </div>
                                            {% endif %}

                                            <!-- NAME VARIANTS DIV -->
                                            <div class="row" style="padding-left:3rem">

                                                <!-- NAME VARIANTS EMPTY ROW -->
                                                <div class="col-auto" style="width:6%;">
                                                    {% if i == size - 1 %}
                                                    {% else %}
                                                    ║
                                                    {% endif %}
                                                </div>

                                                <!-- NAME VARIANTS  -->
                                                <div class="col-auto align-top" style="overflow-x: auto; scroll; width:90%;">
                                                    ╚══ {{ cid }} {{ family[keys[i]][1] }}

                                                    <!-- BUTTON -->
                                                    {% if 'p' not in keys[i]|string %}
                                                    <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                            style=" height:1.8rem; text-align: center; padding-top:0rem;
                                                        padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                        width:8rem%;" name="consistency-ID"
                                                            value="{{keys[i]}} | {{ family[keys[i]][0] }} | {{ analysis_data['cid'] }} | {{ family[first][1] }}"
                                                    >
                                                        <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                              style="padding-bottom:0.3rem; padding-top:0.5rem;
                                                              padding-left:0.2rem; padding-right:0.2rem; width:12rem">
                                                            {{keys[i]}} &nbsp;
                                                            {% if family[keys[i]][4] == 'yes' %}
                                                            <span aria-hidden="true" class="badge rounded-pill likely">
                                                                 VALIDATED
                                                            </span>
                                                            {% else %}
                                                            <span aria-hidden="true" class="badge rounded-pill unlikely">
                                                                 NOT VALIDATED
                                                            </span>
                                                            {% endif %}
                                                        </span>
                                                    </button>
                                                    {% else %}
                                                        <span aria-hidden="true" class="badge rounded-pill unlikely"
                                                              style="padding-bottom:0.2rem; padding-top:0.2rem; width:6rem;">
                                                            {{keys[i]}}
                                                        </span>
                                                    {% endif %}

                                                </div>

                                            </div>

                                            <!-- EMPTY ROW -->
                                            <div class="row" style="padding-left:3rem">
                                                <div class="col-auto" style="width:5%;">
                                                    {% if i == size - 1 %}
                                                    {% else %}
                                                    ║
                                                    {% endif %}
                                                </div>
                                            </div>

                                        {% endfor %}

                                    </div>
                                    </form>
                                    {% endif %}

                                </div>

                            </div>

                        </div>

                    </div>


                    <!-- ACCORDION ITEM 3 : VALIDATED PERSON OBSERVATION TABLE -->
                    {% if analysis_data['validated_table'] is not none %}
                    <div class="accordion-item">

                        <!-- ACCORDION HEADER -->
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed " type="button" data-bs-toggle="collapse"
                                  data-bs-target="#flush-collapse-5" aria-expanded="false" aria-controls="flush-collapse-5">

                                <H4 class="align-text-bottom align-bottom">
                                    Validated Person Observations
                                </H4>

                            </button>
                        </h2>

                        <!-- ACCORDION BODY -->
                        <div id="flush-collapse-5" class="accordion-collapse collapse show"
                             data-bs-parent="#accordionFlush2">
                            <div class="accordion-body">

                                <div class="card-body">

                                    <!-- TABLE OF RECONSTITUTED OF A SPECIFIC SIZE -->
                                    {% for key, list in analysis_data['validated_table'].items() %}

                                        <!-- VALIDATED TABLE -->
                                        <table class="table table-sm caption-top table-hover align-middle"
                                           style="font-size:12px; text-align:center; position:fixed-top">

                                        <!-- TABLE HEADER -->
                                        <thead class="table-success align-text-center align-middle"
                                               style="font-size:16px; position:-webkit-sticky; position:sticky;
                                               top:0; z-index:2;">
                                            <tr style="height:3rem;">
                                                <th scope="col"> </th>
                                                <th scope="col">E. Type</th>
                                                <th scope="col">Cert.</th>
                                                <th scope="col">Cert. Date</th>
                                                <th scope="col">Rec. ID</th>
                                                <th scope="col">Ext. Fa. ID</th>
                                                <th scope="col">Rec. Name</th>
                                                <th scope="col">Role</th>
                                                <th scope="col">Ext. Fa. Name</th>
                                                <th scope="col">Row</th>
                                                <th scope="col">Ext. Fa. Cluster</th>
                                            </tr>
                                        </thead>


                                        <!-- TABLE BODY -->
                                        <tbody class="table-group-divider">

                                            <!-- EMPTY ROW -->
                                            <tr class="align-middle table-white">
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>

                                            <!-- GROUNDED TABLE ROWS -->
                                            {% set outer_loop = loop %}
                                            {% for dict in list %}
                                                <tr class="align-middle table-warning"
                                                style="height:0rem; padding-bottom:0rem; padding-top:0rem;"
                                                onmouseout="ChangeColor(this, false);" onclick="ChangeColor(this, true);">

                                                    <th scope="row">{{loop.index}}</th>
                                                    <td style="color:brown">
                                                        <input type="search" class="form-control me-2" placeholder="Cluster-ID"
                                                             aria-label="Cluster-ID" aria-describedby="basic-addon1"
                                                             value="{{ dict['rid'] }}" name="row-id" id="val-row-id" hidden="">
                                                        {%  if dict['role'] in ['--bHasMother->', '<-bHasMother--', '<-bHasFather--', '--bHasFather->', '--gHasMother->', '<-gHasMother--', '<-gHasFather--', '--gHasFather->', '<--married----', '---married--->'] %}
                                                            M
                                                        {%  elif dict['role'] in ['<-hasFather---', '<-hasMother---', '--nHasFather->', '<-nHasMother---', '--nHasMother->'] %}
                                                            B
                                                        {%  endif %}
                                                    </td>
                                                    <td style="color:brown">{{ dict['certificate'] }}</td>
                                                    <td style="color:brown">{{ dict['certificateDate'] }}</td>
                                                    <td style="color:brown">{{ dict['p_ID'] }}</td>
                                                    <td style="color:brown">{{ dict['associationPersonID'] }}</td>
                                                    <td style="color:brown">{{ dict['p_name'] }}</td>
                                                    <td style="color:brown">{{ dict['role'] }}</td>
                                                    <td style="color:brown">{{ dict['associationPersonName'] }}</td>
                                                    <td style="color:brown">
                                                        {{ dict['rid'] }}
                                                    </td>
                                                    <td style="color:brown">{{ dict['associated_cluster'] }}</td>

                                                </tr>
                                            {% endfor %}

                                        </tbody>

                                    </table>

                                        <!-- VALIDATED FAMILY THREAD -->
                                        <div style="padding-top:1rem; padding-bottom:2rem">

                                                <!-- FAMILY DIV -->
                                                {% if (validated_family[key].keys()|list)[0]|string|length > 0 %}
                                                {% set  family = validated_family[key] -%}
                                                <form class="row g-3"  action="validation_consistency" method="POST">


                                                    <div style="padding-left:1rem">

                                                    {% set keys = family.keys() | list -%}
                                                    {% set first = keys[0] -%}
                                                    {% set size = family|length -%}


                                                    <!-- RECONSTITUTED NAME VARIANTS COUNT -->
                                                    {% if family[first][2] > 1 %}

                                                        <span aria-hidden="true" class="badge rounded-pill unlikely"
                                                              style="padding-bottom:0.5rem; padding-top:0.5rem; width:10.5rem;
                                                              padding-left:1.5rem; padding-right:1.5rem; ">
                                                             <strong>{{ family[first][2] }} name variants  &nbsp;</strong>

                                                                <span aria-hidden="true" class="badge rounded-pill uncertain"
                                                                style="padding-bottom:0.5rem; padding-top:0.5rem;">
                                                                    {% if family[first][4] == 'yes' %}
                                                                     <strong style="font-size:12px">VALIDATED</strong>
                                                                    {% else %}
                                                                    <strong style="font-size:12px">NOT VALIDATED</strong>
                                                                    {% endif %}
                                                                </span>

                                                        </span>
                                                        <br>

                                                    <!-- RECONSTITUTED WITH MORE THAN ONE NAME VARIANTS-->
                                                    {% else %}

                                                        <span aria-hidden="true" class="badge rounded-pill likely"
                                                              style="padding-bottom:0.5rem; padding-top:0.5rem; width:10.5rem;
                                                              padding-left:1.5rem; padding-right:1.5rem;">
                                                             <strong>{{ family[first][2] }} name variants  &nbsp;</strong>

                                                            <span aria-hidden="true" class="badge rounded-pill uncertain"
                                                                style="padding-bottom:0.5rem; padding-top:0.5rem;">
                                                                    {% if family[first][4] == 'yes' %}
                                                                     <strong style="font-size:12px">VALIDATED</strong>
                                                                    {% else %}
                                                                    <strong style="font-size:12px">NOT VALIDATED</strong>
                                                                    {% endif %}
                                                            </span>

                                                        </span>
                                                        <br>

                                                    {% endif %}


                                                    <!-- RECONSTITUTED NAME VARIANTS -->
                                                    {% if family[first][1] %}
                                                        <div style="padding-left:3rem">
                                                            <strong style="color:brown; font-size:24px;">
                                                                {{ family[first][1] }}
                                                            </strong>
                                                            <br>
                                                            ║
                                                        </div>
                                                    {% endif %}


                                                    {% for i in range(1, size) %}

                                                        <!-- ROLES -->
                                                        <div class="row" style="padding-left:3rem">
                                                            <div class="col-auto" >
                                                                {% if i == size - 1 %}
                                                                    ╚══ <b style="color:brown; width:7rem"> {{loop.index}} - {{ family[keys[i]][0] }}</b>
                                                                {% else %}
                                                                    ╠══ <b style="color:brown; width:7rem"> {{loop.index}} - {{ family[keys[i]][0] }}</b>
                                                                {% endif %}
                                                                {% if family[keys[i]][2] > 1 %}
                                                                <span aria-hidden="true" class="badge rounded-pill unlikely"
                                                                          style="padding-bottom:0.2rem; padding-top:0.2rem; width:8rem;">
                                                                     {{ family[keys[i]][2] }} name variants
                                                                </span>
                                                                {% endif %}
                                                            </div>
                                                        </div>


                                                        <!-- EMPTY ROW -->
                                                        {% if family[keys[i]][3] > 1 %}

                                                            <div class="row" style="padding-left:3rem">

                                                                    <div class="col-auto" style="width:6%;">
                                                                        {% if i == size - 1 %}
                                                                        {% else %}
                                                                        ║
                                                                        {% endif %}
                                                                    </div>
                                                                    <div class="col-auto align-top" style="overflow-x: auto; scroll; width:90%;">
                                                                        ║
                                                                    </div>

                                                            </div>


                                                            <!-- CLUSTER SIZE ROW -->
                                                            <div class="row" style="padding-left:3rem">

                                                                    <!-- NAME VARIANTS EMPTY ROW -->
                                                                    <div class="col-auto" style="width:6%;">
                                                                        {% if i == size - 1 %}
                                                                        {% else %}
                                                                        ║
                                                                        {% endif %}
                                                                    </div>

                                                                    <!-- NAME VARIANTS  -->
                                                                    <div class="col-auto align-top" style="overflow-x: auto; scroll; width:90%;">
                                                                        ╠══ Reconstitution of size {{ family[keys[i]][3] }}
                                                                    </div>
                                                            </div>

                                                        {% endif %}


                                                        <!-- NAME VARIANTS DIV -->
                                                        <div class="row" style="padding-left:3rem">

                                                            <!-- NAME VARIANTS EMPTY ROW -->
                                                            <div class="col-auto" style="width:6%;">
                                                                {% if i == size - 1 %}
                                                                {% else %}
                                                                ║
                                                                {% endif %}
                                                            </div>

                                                            <!-- NAME VARIANTS  -->
                                                            <div class="col-auto align-top" style="overflow-x: auto; scroll; width:90%;">
                                                                ╚══ {{ cid }} {{ family[keys[i]][1] }}

                                                                <!-- BUTTON -->
                                                                {% if 'p' not in keys[i]|string %}
                                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                                        style=" height:1.8rem; text-align: center; padding-top:0rem;
                                                                    padding-right:1rem; padding-bottom:1rem; background-color:white;
                                                                    width:8rem%;" name="consistency-ID"
                                                                        value="{{keys[i]}} | {{ family[keys[i]][0] }} | {{ analysis_data['cid'] }} | {{ family[first][1] }}"
                                                                >
                                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-primary"
                                                                          style="padding-bottom:0.3rem; padding-top:0.5rem;
                                                                          padding-left:0.2rem; padding-right:0.2rem; width:12rem">
                                                                        {{keys[i]}} &nbsp;
                                                                        {% if family[keys[i]][4] == 'yes' %}
                                                                        <span aria-hidden="true" class="badge rounded-pill likely">
                                                                             VALIDATED
                                                                        </span>
                                                                        {% else %}
                                                                        <span aria-hidden="true" class="badge rounded-pill unlikely">
                                                                             NOT VALIDATED
                                                                        </span>
                                                                        {% endif %}
                                                                    </span>
                                                                </button>
                                                                {% else %}
                                                                    <span aria-hidden="true" class="badge rounded-pill unlikely"
                                                                          style="padding-bottom:0.2rem; padding-top:0.2rem; width:6rem;">
                                                                        {{keys[i]}}
                                                                    </span>
                                                                {% endif %}

                                                            </div>

                                                        </div>


                                                        <!-- EMPTY ROW -->
                                                        <div class="row" style="padding-left:3rem">
                                                            <div class="col-auto" style="width:5%;">
                                                                {% if i == size - 1 %}
                                                                {% else %}
                                                                ║
                                                                {% endif %}
                                                            </div>
                                                        </div>

                                                    {% endfor %}

                                                </div>
                                                </form>
                                                {% else %}
                                                {% endif %}

                                            </div>

                                    {% endfor %}

                                </div>

                            </div>
                        </div>
                    </div>
                    {% endif %}


                    <!-- ACCORDION ITEM 5 : SUBMITTED RDF-->
                    {% if rdf_data|length > 0 %}
                        <div class="accordion-item">

                            <!-- ACCORDION HEADER -->
                            <h2 class="accordion-header  text-align:middle">

                                <!-- Submitted RDF LABEL -->
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                      data-bs-target="#flush-collapse5" aria-expanded="false" aria-controls="flush-collapse5">
                                    <h4>Submitted RDF of reconstitution {{ analysis_data['cid'] }}</h4>
                                </button>

                            </h2>

                            <!-- ACCORDION BODY -->
                            <div id="flush-collapse5" class="accordion-collapse collapse {{show}}"
                                 data-bs-parent="#accordionFlush2">

                                <!-- CONFIRMATION AND CANCELLATION BUTTONS -->
                                <div class="col input-group text-align:end" style="padding-top:2.5rem; padding-bottom:0rem;">

                                    <!-- CANCELLATION FORM -->
                                    <form class="row g-3"  action="cancel_manual_consistency_validation" method="POST">
                                        <div class="row" style="padding-right:0rem;">

                                            <div class="col-sm-6 mb-3 mb-sm-0 text-middle"
                                                 style="width:100%;  text-align:end;
                                                 padding-bottom:0.8rem; padding-right:0rem;">

                                                <!-- VALIDATED RDF DATA -->
                                                <input type="search" value="{{rdf_data}}"
                                                    name="cancel_rdf" id="cancel_rdf" hidden="">

                                                <!-- FILTER FLAG -->
                                                <input type="search" value="{{ flag_filter }}"
                                                       name="cancel_validation_flag_filter"
                                                       id="cancel_validation_flag_filter" hidden>

                                                <!-- SELECTED CLUSTER SIZE  -->
                                                <input type="search" value="{{ selected_size }}" hidden="hidden"
                                                       name="cancel_validation_cs" id="cancel_validation_cs">

                                                <!--  NEXT PAGE -->
                                                <input type="text" name="cancel_validation_next_page" hidden
                                                       id="cancel_validation_next_page" value="{{ next_page }}">

                                                <!--  SELECTED RECONSTITUTED TABLE INDEX -->
                                                <input type="search" value="{{selected_index}}"
                                                       name="cancel_validation_selected_index"
                                                       id="cancel_validation_selected_index" hidden=>

                                                <!-- CLUSTER ID  -->
                                                <input type="search" value="{{ analysis_data['cid'] }}"
                                                       name="cancel_validation_reconstitution_id"
                                                       id="cancel_validation_reconstitution_id" hidden>

                                                <!-- VALIDATED RECONSTITUTIONS  -->
                                                <input type="search" value="{{ validated }}" name="cancel_validated_rdf"
                                                       id="cancel_validated_rdf" hidden="hidden">

                                                <!-- CANCELLATION BUTTON -->
                                                <button class="btn btn-primary border-light btn-light align-top" type="submit"
                                                    style=" height:1rem; text-align: center; padding-top:0rem; padding-right:0rem;
                                                           padding-bottom:1rem; background-color:white">

                                                <h4>
                                                <span aria-hidden="true" class="badge rounded-pill text-bg-danger"
                                                    style="padding-right:0rem;  padding-top:0.4rem;">
                                                    CANCEL the validation of
                                                    <span aria-hidden="true" class="badge rounded-pill text-bg-dark" >
                                                    {{ analysis_data['cid'] }}
                                                    </span>
                                                </span>
                                                </h4>

                                                  </button>

                                            </div>
                                        </div>
                                    </form>

                                </div>


                                <pre style="padding-left:2rem; font:courier">
                                    {{rdf_data}}
                                </pre>

                            </div>

                        </div>
                    {% endif %}

                </div>

            </div>

        </div>
    </div>
    <p></p>



    <!--
     ------------------------------------------------------------------------------------------------------
     ------------------------------------------------------------------------------------------------------
     -->


    <!--TITLE -->
    {% if analysis_data['groundless_table']|length == 0  and analysis_data['grounded_table']|length == 0  %}
    {% else  %}
    <div class="row text-end" style="padding-top:1rem;">

    <div class="col-auto ">
        <h1 style="text-align: center; color: #C4A484; padding-bottom:1rem;
            font-family:Audiowide, Fantasy; font-weight:bold;">
            <a class="navbar-brand" href="{{ url_for('index')}}" style=";"> C2RC </a>
        </h1>
    </div>

    <div class=" input-group col-auto text-end justify-content-end align-bottom"
         style="width:72%; padding-top:0.5rem; text-align:right;">

            <h3 style="color: #C4A484; padding-bottom:1rem;
                font-family:Audiowide, Fantasy; font-weight: bold;">
                    SELECTED DATABASE &nbsp;
            </h3>

    </div>

    <div class=" input-group col-auto text-end justify-content-end align-bottom"
         style="width:15.2%; padding-top:0.3rem; text-align:right;">

            <h3 style="color: #C4A484; padding-bottom:1rem; font-family:Audiowide, Fantasy; font-weight: bold;">
                    <span class="badge rounded-pill text-bg-info" style="padding-left:2rem; padding-right:2rem;
                    padding-bottom:0.5rem; padding-top:0.5rem; font-family:Helvetica, 'Brush Script', Fantasy">
                        {%if response['db']|length > 0 %} {{ response['selected_db_name'] }} {%else%} None {%endif%}
                    </span>
            </h3>
<

    </div>

</div>
    {% endif  %}


    <!-- THE END  -->
    <p style="padding-top:7rem;"></p>


    <!--script-->
    <script>

        function clearBox(elementID) {
            document.getElementById(elementID).innerHTML = "PROCESSING...";
        } ;

        function color(selected, cycleRowID, colorScheme) {

            var brush = colorScheme[selected.value % 10] ;
            selected.style.backgroundColor = brush ;
            var table = document.getElementById("observations") ;

            for (var r = 1; r < table.rows.length; r++)
            {
                if(table.rows[r].cells[10].innerText === cycleRowID)
                {
                    var found = table.rows[r].cells[11].querySelectorAll('select')[0] ;
                    found.value = selected.value ;
                    found.style.backgroundColor = brush ;
                 }
            }
        } ;

        function ChangeColor(tableRow, highLight)
        {
            if (highLight)
            {
              tableRow.style.backgroundColor = '#dcfac9';
            }
            else
            {
              tableRow.style.backgroundColor = 'white';
            }
        } ;

        function change_Color2(event) {
          var red = document.getElementById(red);
          var green = document.getElementById(green);
          var blue = document.getElementById(blue);
            red.style.color = "red";
        };

    </script>





    <script type="text/javascript">
      function resizeIframe(obj){
         obj.style.height = 0;
         obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
      }

    const alertPlaceholder = document.getElementById('liveAlertPlaceholder')

    const alert = (message, type) => {
      const wrapper = document.createElement('div')
      wrapper.innerHTML = [
        `<div class="alert alert-${type} alert-dismissible" role="alert">`,
        `   <div>${message}</div>`,
        '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
        '</div>'
      ].join('')

      alertPlaceholder.append(wrapper)
    }

    const alertTrigger = document.getElementById('liveAlertBtn')
    if (alertTrigger) {
      alertTrigger.addEventListener('click', () => {
        alert('Nice, you triggered this alert message!', 'success')
      })
    }
    </script>


{% endblock %}

